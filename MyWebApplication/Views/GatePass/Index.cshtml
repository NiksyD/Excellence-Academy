@model IEnumerable<MyWebApplication.Models.GatePass>
@{
	ViewData["Title"] = "Gate Pass Management - Excellence Academy";
}

<!-- Header Section -->
<section class="bg-primary text-white py-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
	<div class="container">
		<div class="row align-items-center">
			<div class="col-md-8">
				<h1 class="display-5 fw-bold mb-2">
					<i class="fas fa-id-card me-3"></i>Gate Pass Management
				</h1>
				<p class="lead mb-0">Manage vehicle gate pass applications and approvals</p>
			</div>
			<div class="col-md-4 text-md-end">
				<a asp-controller="GatePass" asp-action="Create" class="btn btn-light btn-lg rounded-pill px-4">
					<i class="fas fa-plus me-2"></i>New Gate Pass
				</a>
			</div>
		</div>
	</div>
</section>

<!-- Main Content -->
<div class="container py-5">
	<!-- Statistics Cards -->
	<div class="row mb-5">
		<div class="col-md-3 col-6 mb-3">
			<div class="card bg-primary text-white h-100">
				<div class="card-body text-center">
					<i class="fas fa-file-alt fa-2x mb-2"></i>
					<h4 class="fw-bold">@(Model?.Count() ?? 0)</h4>
					<p class="mb-0">Total Applications</p>
				</div>
			</div>
		</div>
		<div class="col-md-3 col-6 mb-3">
			<div class="card bg-warning text-white h-100">
				<div class="card-body text-center">
					<i class="fas fa-clock fa-2x mb-2"></i>
					<h4 class="fw-bold">@(Model?.Where(g => g.Status == "Pending").Count() ?? 0)</h4>
					<p class="mb-0">Pending</p>
				</div>
			</div>
		</div>
		<div class="col-md-3 col-6 mb-3">
			<div class="card bg-success text-white h-100">
				<div class="card-body text-center">
					<i class="fas fa-check-circle fa-2x mb-2"></i>
					<h4 class="fw-bold">@(Model?.Where(g => g.Status == "Approved").Count() ?? 0)</h4>
					<p class="mb-0">Approved</p>
				</div>
			</div>
		</div>
		<div class="col-md-3 col-6 mb-3">
			<div class="card bg-danger text-white h-100">
				<div class="card-body text-center">
					<i class="fas fa-times-circle fa-2x mb-2"></i>
					<h4 class="fw-bold">@(Model?.Where(g => g.Status == "Rejected").Count() ?? 0)</h4>
					<p class="mb-0">Rejected</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Search and Filter Section -->
	<div class="card shadow-sm mb-4">
		<div class="card-body">
			<div class="row align-items-center">
				<div class="col-md-4">
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-search"></i></span>
						<input type="text" class="form-control" placeholder="Search gate passes..." id="searchInput">
					</div>
				</div>
				<div class="col-md-3">
					<select class="form-select" id="statusFilter">
						<option value="">All Status</option>
						<option value="Pending">Pending</option>
						<option value="Approved">Approved</option>
						<option value="Rejected">Rejected</option>
					</select>
				</div>
				<div class="col-md-3">
					<select class="form-select" id="departmentFilter">
						<option value="">All Departments</option>
						@if (Model != null)
						{
							@foreach (var dept in Model.Select(g => g.Department).Distinct().Where(d => !string.IsNullOrEmpty(d)))
							{
								<option value="@dept">@dept</option>
							}
						}
					</select>
				</div>
				<div class="col-md-2">
					<button class="btn btn-outline-primary w-100" onclick="exportToCSV()">
						<i class="fas fa-download me-2"></i>Export
					</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Gate Pass Table -->
	<div class="card shadow-sm">
		<div class="card-header bg-light">
			<h5 class="mb-0"><i class="fas fa-table me-2"></i>Gate Pass Applications</h5>
		</div>
		<div class="card-body p-0">
			@if (Model != null && Model.Any())
			{
				<div class="table-responsive">
					<table class="table table-hover mb-0" id="gatePassTable">
						<thead class="table-primary">
							<tr>
								<th class="px-4 py-3">
									<i class="fas fa-hashtag me-2"></i>ID
								</th>
								<th class="px-4 py-3">
									<i class="fas fa-user me-2"></i>Applicant
								</th>
								<th class="px-4 py-3">
									<i class="fas fa-building me-2"></i>Department
								</th>
								<th class="px-4 py-3">
									<i class="fas fa-car me-2"></i>Vehicle
								</th>
								<th class="px-4 py-3">
									<i class="fas fa-calendar me-2"></i>Date
								</th>
								<th class="px-4 py-3">
									<i class="fas fa-info-circle me-2"></i>Status
								</th>
								<th class="px-4 py-3 text-center">
									<i class="fas fa-cogs me-2"></i>Actions
								</th>
							</tr>
						</thead>
						<tbody>
							@foreach (var gatePass in Model)
							{
								<tr>
									<td class="px-4 py-3">
										<span class="badge bg-secondary">#@gatePass.Id</span>
									</td>
									<td class="px-4 py-3">
										<div class="d-flex align-items-center">
											<div class="avatar bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
												<span class="text-white fw-bold">@(gatePass.Name?.Substring(0, 1))</span>
											</div>
											<div>
												<div class="fw-medium">@gatePass.Name</div>
												<small class="text-muted">@gatePass.Address</small>
											</div>
										</div>
									</td>
									<td class="px-4 py-3">
										<span class="badge bg-info">@gatePass.Department</span>
										@if (!string.IsNullOrEmpty(gatePass.Faculty))
										{
											<br><small class="text-muted">@gatePass.Faculty</small>
										}
									</td>
									<td class="px-4 py-3">
										<div class="fw-medium">@gatePass.VehiclePlateNo</div>
										<small class="text-muted">@gatePass.VehicleType</small>
									</td>
									<td class="px-4 py-3">
										<small class="text-muted">
											@gatePass.Date.ToString("MMM dd, yyyy")
										</small>
									</td>
									<td class="px-4 py-3">
										@if (gatePass.Status == "Pending")
										{
											<span class="badge bg-warning">Pending</span>
										}
										else if (gatePass.Status == "Approved")
										{
											<span class="badge bg-success">Approved</span>
										}
										else if (gatePass.Status == "Rejected")
										{
											<span class="badge bg-danger">Rejected</span>
										}
									</td>
									<td class="px-4 py-3 text-center">
										<div class="btn-group" role="group">
											<a asp-action="Details" asp-route-id="@gatePass.Id" 
											   class="btn btn-outline-info btn-sm" 
											   title="View Details">
												<i class="fas fa-eye"></i>
											</a>
											@if (gatePass.Status == "Pending")
											{
												<a asp-action="Edit" asp-route-id="@gatePass.Id" 
												   class="btn btn-outline-warning btn-sm" 
												   title="Edit Application">
													<i class="fas fa-edit"></i>
												</a>
												<a asp-action="Review" asp-route-id="@gatePass.Id" 
												   class="btn btn-outline-success btn-sm" 
												   title="Review Application">
													<i class="fas fa-clipboard-check"></i>
												</a>
											}
										</div>
									</td>
								</tr>
							}
						</tbody>
					</table>
				</div>
			}
			else
			{
				<div class="text-center py-5">
					<i class="fas fa-id-card fa-4x text-muted mb-3"></i>
					<h4 class="text-muted">No Gate Pass Applications Found</h4>
					<p class="text-muted mb-4">Start by creating your first gate pass application.</p>
					<a asp-controller="GatePass" asp-action="Create" class="btn btn-primary btn-lg rounded-pill px-4">
						<i class="fas fa-plus me-2"></i>Create First Gate Pass
					</a>
				</div>
			}
		</div>
	</div>
</div>

@section Scripts {
	<script src="~/js/GatePass/index.js"></script>
}